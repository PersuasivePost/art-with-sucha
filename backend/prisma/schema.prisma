generator client {
  provider = "prisma-client-js"
  // output = "../node_modules/@prisma/client/.prisma/client"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model Section {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  coverImage  String?
  parentId    Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]
  parent      Section?  @relation("SubSections", fields: [parentId], references: [id], onDelete: Cascade)
  children    Section[] @relation("SubSections")

  @@unique([name, parentId])
}

model Product {
  id          Int         @id @default(autoincrement())
  title       String
  description String?
  price       Float
  tags        String[]
  sectionId   Int
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  images      String[]
  section     Section     @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  cartItems   CartItem[]
  orderItems  OrderItem[]
  reviews     Review[]
  wishlistItems WishlistItem[]
}

model User {
  id           Int         @id @default(autoincrement())
  name         String?
  email        String      @unique
  password     String
  mobno        String?
  address      String?
  orderSummary Json?       @default("[]")
  isAdmin      Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  cartItems    CartItem[]
  orders       Order[]
  reviews      Review[]
  wishlistItems WishlistItem[]
}

model CartItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

model Order {
  id                  Int         @id @default(autoincrement())
  userId              Int
  totalAmount         Float
  status              String      @default("pending") // pending, paid, completed, cancelled
  razorpayOrderId     String?     @unique
  razorpayPaymentId   String?
  razorpaySignature   String?
  paymentStatus       String?     @default("pending") // pending, authorized, captured, failed
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  user                User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems          OrderItem[]

  @@index([userId])
  @@index([status])
  @@index([razorpayOrderId])
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Float
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}

model Review {
  id        Int      @id @default(autoincrement())
  productId Int
  userId    Int
  rating    Int
  message   String?
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
}

model WishlistItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}