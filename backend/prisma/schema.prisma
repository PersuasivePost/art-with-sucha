generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Section {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  coverImage  String?    // URL to cover image in Cloudflare R2
  parentId    Int?       // null means top-level section (Level 1)
  
  // Self-referencing relation for nested sections
  parent      Section?   @relation("SubSections", fields: [parentId], references: [id], onDelete: Cascade)
  children    Section[]  @relation("SubSections")
  
  // Products can only exist in sections (we'll enforce Level 3 in business logic)
  products    Product[]

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Ensure unique names within the same parent section
  @@unique([name, parentId])
}

model Product {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  price       Float    // Price in your currency
  tags        String[] // Array of tags for filtering/searching  
  imageUrl    String   // URL to product image in Cloudflare R2

  sectionId   Int      // Foreign key to Section (must be Level 3)
  section     Section  @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
